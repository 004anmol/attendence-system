<!DOCTYPE html>
<html>
<head>
<title>Client Group & Site Lookup</title>
<style>
/* Basic styling for the form container */
body {
font-family: 'Roboto', sans-serif;
background-color: #f1f3f4;
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
margin: 0;
}

form {
background-color: #ffffff;
border-radius: 8px;
box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
padding: 30px;
width: 100%;
max-width: 600px;
margin: 20px;
}

h2 {
font-size: 24px;
color: #202124;
margin-bottom: 20px;
text-align: center;
}

label {
display: block;
font-size: 14px;
color: #5f6368;
margin-top: 15px;
margin-bottom: 5px;
}

input, select, button {
width: 100%;
padding: 12px;
margin-bottom: 15px;
border: 1px solid #dadce0;
border-radius: 6px;
font-size: 14px;
box-sizing: border-box;
transition: border 0.2s, box-shadow 0.2s;
}

input:focus, select:focus {
border: 1px solid #1a73e8;
box-shadow: 0 1px 4px rgba(26, 115, 232, 0.3);
outline: none;
}

button {
background-color: #1a73e8;
color: white;
font-weight: 500;
border: none;
cursor: pointer;
transition: background-color 0.3s ease;
}

button:hover {
background-color: #1967d2;
}

#fileList {
list-style: none;
padding-left: 0;
font-size: 14px;
color: #202124;
}

#progressContainer {
display: none;
margin-top: 10px;
}

#progressBar {
height: 8px;
background-color: #1a73e8;
border-radius: 4px;
text-align: center;
color: white;
font-size: 12px;
}
</style>
<script>
let files = [];

function getSiteName() {
const siteCode = document.getElementById("sitecode").value;
google.script.run.withSuccessHandler(displaySiteAndClientGroup).fetchSiteName(siteCode);
}

function displaySiteAndClientGroup(data) {
document.getElementById("sitename").value = data.siteName;
document.getElementById("clientGroup").value = data.clientGroup;
}

function handleFileSelect(event) {
const file = event.target.files[0];
if (file) {
const reader = new FileReader();
reader.onloadend = function () {
const fileData = {
data: reader.result.split(",")[1],
name: file.name
};
files.push(fileData);
displayFiles();
};
reader.readAsDataURL(file);
}
}

function displayFiles() {
const fileList = document.getElementById("fileList");
fileList.innerHTML = "";
files.forEach((file) => {
const fileItem = document.createElement("li");
fileItem.textContent = file.name;
fileList.appendChild(fileItem);
});
}

async function saveFormData() {
const clientGroup = document.getElementById("clientGroup").value;
const siteCode = document.getElementById("sitecode").value;
const siteName = document.getElementById("sitename").value;
const date = document.getElementById("date").value;
const phoneNumber = document.getElementById("phone").value;
const gmail = document.getElementById("gmail").value;

if (phoneNumber.length !== 10) {
alert("Phone number must be exactly 10 digits.");
return;
}

const progressContainer = document.getElementById("progressContainer");
const progressBar = document.getElementById("progressBar");
progressContainer.style.display = "block";
progressBar.style.width = "0%";
progressBar.textContent = "0%";

for (let i = 0; i < files.length; i++) {
try {
await google.script.run
.withSuccessHandler((fileUrl) => {
console.log("File uploaded:", fileUrl);
})
.withFailureHandler((error) => {
alert(`File ${files[i].name} failed to upload: ${error.message}`);
console.error("Upload error:", error.message);
})
.uploadFile(files[i], clientGroup, siteCode, siteName, date, phoneNumber, gmail);

const progress = Math.round(((i + 1) / files.length) * 100);
progressBar.style.width = progress + "%";
progressBar.textContent = progress + "%";
} catch (error) {
console.error("Upload failed for file:", files[i].name, error);
}
}

alert("All files uploaded and form data saved!");
files = [];
displayFiles();
progressContainer.style.display = "none";

// window.location.reload();
resetForm();

}

// function resetForm() {
// document.getElementById("clientGroup").value = "";
// document.getElementById("sitecode").value = "";
// document.getElementById("sitename").value = "";
// // document.getElementById("date").value = "";
// document.getElementById("phone").value = "";
// document.getElementById("gmail").value = "";
// document.getElementById("fileInput").value = "";
// files = [];
// displayFiles();
// }

function resetForm() {
// Reset all input fields
const inputs = document.querySelectorAll("input");
inputs.forEach((input) => {
if (input.type === "text" || input.type === "tel" || input.type === "email") {
input.value = ""; // Clear text, tel, and email inputs
} else if (input.type === "file") {
input.value = ""; // Clear file input
}
});

// Reset any displayed files
files = [];
displayFiles();

// Manually reset other elements if needed
document.getElementById("clientGroup").value = "";
document.getElementById("sitename").value = "";

// Hide progress bar (if visible)
const progressContainer = document.getElementById("progressContainer");
if (progressContainer) {
progressContainer.style.display = "none";
}
}


function setDateAutomatically() {
const dateField = document.getElementById("date");
const now = new Date();
const formattedDate = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()}`;
dateField.value = formattedDate;
}

window.onload = function () {
setDateAutomatically();
document.getElementById("fileInput").addEventListener("change", handleFileSelect);
};
</script>

</head>
<body>
<form onsubmit="event.preventDefault(); saveFormData();">
<h2>Client Group & Site Lookup</h2>

<label for="sitecode">Site Code:</label>
<input type="text" id="sitecode" placeholder="Enter Site Code" required maxlength="5" inputmode="numeric" onblur="getSiteName()">

<label for="clientGroup">Client Group:</label>
<input type="text" id="clientGroup" placeholder="The Client Name will be filled in automatically" readonly>


<label for="sitename">Site Name:</label>
<input type="text" id="sitename" placeholder="The Site Name will be filled in automatically" readonly>

<label for="date" style="display:none">Date:</label>
<input type="text" id="date" readonly style="display:none" >

<label for="phone">Phone Number:</label>
<input type="tel" id="phone" placeholder="Enter Phone Number" required maxlength="10" inputmode="numeric">

<label for="gmail">Email (Optional):</label>
<input type="email" id="gmail" placeholder="Enter Email">

<label for="fileInput">Upload File:</label>
<input type="file" id="fileInput" accept="image/*,application/pdf" required multiple>

<ul id="fileList"></ul>

<div id="progressContainer">
<div id="progressBar">0%</div>
</div>

<button type="submit">Submit</button>
</form>
</body>
</html>
